groups:
  - name: RoomBillzAlerts
    rules:

      # ======================================================
      # ROOMBILLZ-SERVICE Alerts (Main App ‚Äì strict thresholds)
      # ======================================================

      - alert: RoomBillzServiceDown
        expr: up{application="ROOMBILLZ-SERVICE"} == 0
        for: 30s
        labels:
          severity: critical
          service: roomBillz
        annotations:
          summary: "üö® RoomBillz Service DOWN"
          description: |
            Env: {{ $labels.env }}
            Service: ROOMBILLZ-SERVICE
            Instance: {{ $labels.instance }}
            Status: ‚ùå DOWN

      - alert: RoomBillzHighLatencyP95
        expr: job:http_request_duration_seconds:p95{application="ROOMBILLZ-SERVICE"} > 0.35
        for: 5m
        labels:
          severity: warning
          service: roomBillz
        annotations:
          summary: "‚ö†Ô∏è High Latency (RoomBillz Service)"
          description: |
            p95 latency is high: {{ $value | printf "%.3f" }}s (limit: 0.35s)

      - alert: RoomBillzHighErrorRate
        expr: job:http_error_ratio:percent5m{application="ROOMBILLZ-SERVICE"} > 2
        for: 5m
        labels:
          severity: warning
          service: roomBillz
        annotations:
          summary: "‚ö†Ô∏è RoomBillz Error Rate High"
          description: |
            Error rate: {{ $value | printf "%.2f" }}% (>2%).

      - alert: RoomBillzHighJVMHeapUsage
        expr: job:jvm_heap_used_percent{application="ROOMBILLZ-SERVICE"} > 85
        for: 10m
        labels:
          severity: warning
          service: roomBillz
        annotations:
          summary: "‚ö†Ô∏è RoomBillz JVM Memory High"
          description: |
            Heap used: {{ $value | printf "%.1f" }}%



      # ======================================================
      # ROOMBILLZ-NOTIFICATION-SERVICE Alerts (Relaxed)
      # ======================================================

      - alert: NotificationServiceDown
        expr: up{application="ROOMBILLZ-NOTIFICATION-SERVICE"} == 0
        for: 30s
        labels:
          severity: critical
          service: notification
        annotations:
          summary: "üö® Notification Service DOWN"
          description: |
            Env: {{ $labels.env }}
            Instance: {{ $labels.instance }}

      - alert: NotificationHighLatencyP95
        expr: job:http_request_duration_seconds:p95{application="ROOMBILLZ-NOTIFICATION-SERVICE"} > 0.8
        for: 5m
        labels:
          severity: warning
          service: notification
        annotations:
          summary: "‚ö†Ô∏è Notification Service Slow"
          description: |
            p95 latency: {{ $value | printf "%.3f" }}s

      - alert: NotificationHighErrorRate
        expr: job:http_error_ratio:percent5m{application="ROOMBILLZ-NOTIFICATION-SERVICE"} > 5
        for: 5m
        labels:
          severity: warning
          service: notification
        annotations:
          summary: "‚ö†Ô∏è Notification Error Rate High"
          description: |
            Errors: {{ $value | printf "%.2f" }}% (>5%).



      # ======================================================
      # EUREKA-SERVER Alerts
      # ======================================================

      - alert: EurekaServerDown
        expr: up{application="ROOMBILLZ-EUREKA-SERVER"} == 0
        for: 20s
        labels:
          severity: critical
          service: eureka
        annotations:
          summary: "üö® Eureka Server DOWN"
          description: |
            Eureka is unreachable.

      - alert: EurekaNoInstancesRegistered
        expr: eureka_instances_up == 0
        for: 2m
        labels:
          severity: warning
          service: eureka
        annotations:
          summary: "‚ö†Ô∏è No Services Registered in Eureka"
          description: |
            Eureka is running but shows 0 instances.

      - alert: EurekaInstanceCountLow
        expr: eureka_instances_up < 2
        for: 2m
        labels:
          severity: warning
          service: eureka
        annotations:
          summary: "‚ö†Ô∏è Some services not registered in Eureka"
          description: |
            Registered: {{ $value | printf "%.0f" }} (Expected ‚â•2).



      # ======================================================
      # ROOMBILLZ-SCHEDULER-SERVICE Alerts
      # ======================================================

      - alert: SchedulerServiceDown
        expr: up{application="ROOMBILLZ-SCHEDULER-SERVICE"} == 0
        for: 30s
        labels:
          severity: critical
          service: scheduler
        annotations:
          summary: "üö® Scheduler Service DOWN"
          description: |
            Instance: {{ $labels.instance }}

      - alert: SchedulerHighJVMHeapUsage
        expr: job:jvm_heap_used_percent{application="ROOMBILLZ-SCHEDULER-SERVICE"} > 85
        for: 10m
        labels:
          severity: warning
          service: scheduler
        annotations:
          summary: "‚ö†Ô∏è Scheduler JVM Memory High"
          description: |
            Heap: {{ $value | printf "%.1f" }}%

      - alert: SchedulerJobExecutionError
        expr: increase(roomBillz_scheduler_job_failed_total[5m]) > 3
        for: 5m
        labels:
          severity: warning
          service: scheduler
        annotations:
          summary: "‚ö†Ô∏è Scheduler Job Failures Detected"
          description: |
            Failures (last 5m): {{ $value | printf "%.0f" }}

      - alert: SchedulerJobExecutionDurationHigh
        expr: histogram_quantile(0.95, sum(rate(roomBillz_scheduler_job_execution_seconds_bucket[5m])) by (le, application)) > 5
        for: 5m
        labels:
          severity: warning
          service: scheduler
        annotations:
          summary: "‚ö†Ô∏è Scheduler Job Execution Time High"
          description: |
            p95 duration: {{ $value | printf "%.1f" }}s



      # ======================================================
      # ROOMBILLZ-DOCUMENT-SERVICE Alerts (New)
      # ======================================================

      - alert: DocumentServiceDown
        expr: up{application="ROOMBILLZ-DOCUMENT-SERVICE"} == 0
        for: 30s
        labels:
          severity: critical
          service: document
        annotations:
          summary: "üö® Document Service DOWN"
          description: |
            Env: {{ $labels.env }}
            Instance: {{ $labels.instance }}
            Status: ‚ùå DOWN

      - alert: DocumentServiceHighLatencyP95
        expr: job:http_request_duration_seconds:p95{application="ROOMBILLZ-DOCUMENT-SERVICE"} > 0.6
        for: 5m
        labels:
          severity: warning
          service: document
        annotations:
          summary: "‚ö†Ô∏è Document Service High Latency"
          description: |
            p95 latency: {{ $value | printf "%.3f" }}s (limit: 0.6s)

      - alert: DocumentServiceHighErrorRate
        expr: job:http_error_ratio:percent5m{application="ROOMBILLZ-DOCUMENT-SERVICE"} > 4
        for: 5m
        labels:
          severity: warning
          service: document
        annotations:
          summary: "‚ö†Ô∏è Document Service Error Rate High"
          description: |
            Error rate: {{ $value | printf "%.2f" }}% (>4%)

      - alert: DocumentServiceJVMHeapUsageHigh
        expr: job:jvm_heap_used_percent{application="ROOMBILLZ-DOCUMENT-SERVICE"} > 85
        for: 10m
        labels:
          severity: warning
          service: document
        annotations:
          summary: "‚ö†Ô∏è Document Service JVM Memory High"
          description: |
            Heap used: {{ $value | printf "%.1f" }}%
